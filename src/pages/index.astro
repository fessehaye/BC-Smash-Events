---
// Component Imports
import Card from '../components/Card.astro';
import Footer from '../components/Footer.astro';
const response = await fetch('https://dev--bcevents.fessehaye.autocode.gg/');
const data = await response.json();
let events = [];

const gamesNames = {
  1: 'Melee',
  2: 'P+',
  1386: 'Ultimate'
}

if(data) {
  events = data.map(e => {
    return {
      name: e.name,
      date: new Date(e.startAt*1000),
      city: e.city,
      url: e.url,
      image: e.images.find(i => i.type === 'banner')?.url,
      games: [... new Set(e.events.map(event => event.videogame.id).filter(event => event in gamesNames).map(event => gamesNames[event]))]
    }
   })
}
---
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <title>BC Smash Events</title>
    <meta name="title" content="BC Smash Events">
    <meta property="og.title" content="BC Smash Events">
    <meta property="og.url" content="https://bc-smash.netlify.app">
    <meta property="twitter.url" content="https://bc-smash.netlify.app">
    <meta property="twitter.title" content="BC Smash Events">
    <meta property="og.type" content="website">
    <meta property="twitter.card" content="summary">
    <meta property="og.description" content="View the latest BC smash events for Melee, Ultimate and P+">
    <meta property="twitter.description" content="View the latest BC smash events for Melee, Ultimate and P+">
    <meta name="description" content="View the latest BC smash events for Melee, Ultimate and P+">
    <meta name="keywords" content="Smash Bros, Melee, Vancouver, Ultimate, P+, Switch, Gamecube">
    <meta name="robots" content="index, follow">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="language" content="English">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#5c5c5c">
    <link rel="stylesheet" type="text/css" href={Astro.resolve("../styles/global.css")}>
    <link rel="manifest" href="/manifest.json">

  </head>

  <body class="bg-gradient-to-r from-gray-700 via-gray-900 to-black flex flex-col min-h-screen">
    <main class="flex-grow">
      <h1 class="text-white mx-auto font-sans font-bold px-5 pt-12 text-xl lg:text-2xl text-center max-w-4xl">This page contains upcoming smash.gg events that are taking place in BC. Click on a card to open the event's smash.gg page.</h1>
      <div class="max-w-6xl mx-auto px-5 pb-12 pt-12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 auto-rows-fr gap-x-8 gap-y-12">
        {events.map((event,index) => (
          <Card event={event} index={index} />
        ))}
      </div>
    </main>
    <Footer />
  </body>

  <script>
    // Check that service workers are supported
    if ('serviceWorker' in navigator) {
      // Use the window load event to keep the page load performant
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js');
      });
    }
  </script>
</html>

---
// Component Imports
import Card from '../components/Card.astro';
const response = await fetch('https://dev--bcevents.fessehaye.autocode.gg/');
const data = await response.json();
let events = [];

const gamesNames = {
  1: 'Melee',
  2: 'P+',
  1386: 'Ultimate'
}

if(data) {
  events = data.map(e => {
    return {
      name: e.name,
      date: new Date(e.startAt*1000),
      city: e.city,
      url: e.url,
      image: e.images.find(i => i.type === 'banner')?.url,
      games: [... new Set(e.events.map(event => event.videogame.id).filter(event => event in gamesNames).map(event => gamesNames[event]))]
    }
   })
}
---
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <title>BC Smash Events</title>
    <meta name="title" content="BC Smash Events">
    <meta name="description" content="View the latest BC smash events for Melee, Ultimate and P+">
    <meta name="keywords" content="Smash Bros, Melee, Vancouver, Ultimate, P+, Switch, Gamecube">
    <meta name="robots" content="index, follow">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="language" content="English">
    
    <link rel="stylesheet" type="text/css" href={Astro.resolve("../styles/global.css")}>
  </head>

  <body class="bg-gradient-to-r from-blue-600 to-blue-700">
    <div class="max-w-6xl mx-auto px-5 py-24 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {events.map((event) => (
        <Card event={event} />
      ))}
    </div>
  </body>
</html>
